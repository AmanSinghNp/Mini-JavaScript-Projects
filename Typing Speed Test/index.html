<!DOCTYPE html>
<html class="dark" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Typing Test: Pre-Test</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap"
      rel="stylesheet"
    />
    <!-- Material Symbols -->
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
      rel="stylesheet"
    />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Tailwind Config -->
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#135bec",
              "background-light": "#f6f6f8",
              "background-dark": "#101622",
              "surface-dark": "#18202F",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
              mono: ["JetBrains Mono", "monospace"],
            },
            borderRadius: {
              DEFAULT: "0.25rem",
              lg: "0.5rem",
              xl: "0.75rem",
              full: "9999px",
            },
            animation: {
              "caret-blink": "blink 1.2s infinite",
            },
            keyframes: {
              blink: {
                "0%, 100%": { opacity: "1" },
                "50%": { opacity: "0" },
              },
            },
          },
        },
      };
    </script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body
    class="bg-background-light dark:bg-background-dark min-h-screen flex flex-col font-display overflow-hidden text-slate-900 dark:text-white transition-colors duration-300"
  >
    <!-- Header / Metrics -->
    <header
      class="w-full px-8 py-6 flex justify-between items-start z-50 transition-opacity duration-500"
      id="header-chrome"
    >
      <!-- WPM Counter -->
      <div
        class="flex flex-col items-start gap-1 opacity-60 hover:opacity-100 transition-opacity"
        role="status"
        aria-live="polite"
        aria-atomic="true"
      >
        <span
          class="text-xs uppercase tracking-wider font-bold text-gray-500 dark:text-gray-400"
          >WPM</span
        >
        <span
          class="text-2xl font-mono font-medium text-gray-800 dark:text-gray-200"
          id="wpm-display"
          aria-label="Words per minute: 0"
          >0</span
        >
      </div>

      <!-- CPM Counter -->
      <div
        class="hidden md:flex flex-col items-start gap-1 opacity-60 hover:opacity-100 transition-opacity"
      >
        <span
          class="text-xs uppercase tracking-wider font-bold text-gray-500 dark:text-gray-400"
          >CPM</span
        >
        <span
          class="text-2xl font-mono font-medium text-gray-800 dark:text-gray-200"
          id="cpm-display"
          aria-label="Characters per minute: 0"
          >0</span
        >
      </div>

      <!-- Logo / Brand -->
      <div class="hidden md:flex items-center gap-2 opacity-20">
        <span class="material-symbols-outlined text-3xl">keyboard</span>
      </div>

      <!-- Timer -->
      <div
        class="flex flex-col items-end gap-1 opacity-60 hover:opacity-100 transition-opacity"
        role="timer"
        aria-live="polite"
        aria-atomic="true"
      >
        <span
          class="text-xs uppercase tracking-wider font-bold text-gray-500 dark:text-gray-400"
          >Time</span
        >
        <span
          class="text-2xl font-mono font-medium text-primary"
          id="time-display"
          aria-label="Time remaining: 60 seconds"
          >60s</span
        >
        <span
          id="caps-lock-warning"
          class="hidden text-xs font-semibold text-red-500 mt-1"
          aria-live="polite"
        >
          Caps Lock is ON
        </span>
      </div>
    </header>

    <!-- Timer Progress Bar -->
    <div
      class="w-full px-8 mt-2"
      aria-label="Time remaining progress"
      role="progressbar"
      aria-valuemin="0"
      aria-valuemax="100"
      aria-valuenow="100"
      id="progress-track"
    >
      <div id="progress-bar"></div>
    </div>

    <!-- Main Typing Area -->
    <main
      class="flex-grow flex flex-col items-center justify-center w-full max-w-[1200px] mx-auto px-6 relative"
    >
      <!-- Focus Indicator Overlay -->
      <div
        class="absolute inset-0 pointer-events-none z-0 bg-gradient-to-b from-transparent via-background-light/50 dark:via-background-dark/50 to-background-light dark:to-background-dark opacity-0 transition-opacity duration-300"
        id="focus-overlay"
      ></div>

      <div
        class="layout-content-container flex flex-col w-full max-w-[900px] z-10"
      >
        <!-- Text Passage Container -->
        <!-- Using tabindex="0" to capture keyboard events when focused -->
        <div
          class="relative no-select cursor-text outline-none"
          id="typing-area"
          tabindex="0"
          role="textbox"
          aria-label="Typing test area"
        >
          <p
            class="font-mono text-2xl md:text-3xl lg:text-[2rem] leading-relaxed tracking-wide text-gray-400 dark:text-gray-600 text-left transition-colors"
            id="text-display"
            aria-label="Text to type"
          >
            <!-- Text will be injected here by JS -->
          </p>
          <input
            type="text"
            id="input-field"
            class="absolute opacity-0 -z-10"
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
            aria-label="Typing input field"
            aria-describedby="instruction-hint"
          />
        </div>

        <!-- Instruction Hint -->
        <div
          class="mt-12 flex justify-center"
          id="instruction-hint"
          role="status"
          aria-live="polite"
        >
          <p
            class="text-gray-400 dark:text-gray-500 text-sm font-medium tracking-wide animate-pulse"
          >
            Start typing to begin
          </p>
        </div>
        <div
          id="pause-indicator"
          class="hidden mt-3 text-sm text-amber-500 text-center font-semibold"
          aria-live="assertive"
        >
          Paused (window not focused)
        </div>

        <!-- Virtual Keyboard (desktop only) -->
        <div
          id="virtual-keyboard"
          class="hidden md:flex flex-col gap-2 mt-10"
          aria-label="Virtual keyboard"
        ></div>

        <!-- Results Overlay (Hidden by default) -->
        <div
          id="results-overlay"
          class="hidden absolute inset-0 z-20 flex flex-col items-center justify-center bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-md opacity-0 transition-opacity duration-500"
          role="dialog"
          aria-modal="true"
          aria-labelledby="results-title"
          aria-hidden="true"
        >
          <div
            class="text-center transform transition-all duration-500 scale-95 relative"
            id="results-content"
          >
            <!-- Close Button -->
            <button
              id="close-results-btn"
              aria-label="Close Results"
              class="absolute top-0 right-0 text-gray-400 hover:text-gray-800 dark:hover:text-white transition-colors p-2"
            >
              <span class="material-symbols-outlined">close</span>
            </button>

            <h2
              id="results-title"
              class="text-xl text-gray-500 font-medium mb-2"
            >
              Test Completed
            </h2>
            <div
              class="text-8xl font-black text-primary mb-4 font-display tracking-tight"
              id="final-wpm"
            >
              0
            </div>
            <div
              class="flex gap-6 justify-center mb-4 text-gray-500 dark:text-gray-400 text-sm"
            >
              <div class="flex items-center gap-2">
                <span class="font-semibold">Raw WPM:</span>
                <span
                  id="final-raw-wpm"
                  class="font-mono text-gray-800 dark:text-gray-100"
                  >0</span
                >
              </div>
              <div class="flex items-center gap-2">
                <span class="font-semibold">CPM:</span>
                <span
                  id="final-cpm"
                  class="font-mono text-gray-800 dark:text-gray-100"
                  >0</span
                >
              </div>
            </div>
            <div class="flex gap-8 justify-center mb-6">
              <div class="flex flex-col items-center">
                <span class="text-sm text-gray-400 uppercase tracking-wider"
                  >Accuracy</span
                >
                <span
                  class="text-2xl font-mono text-green-500"
                  id="final-accuracy"
                  >100%</span
                >
              </div>
              <div class="flex flex-col items-center">
                <span class="text-sm text-gray-400 uppercase tracking-wider"
                  >Errors</span
                >
                <span class="text-2xl font-mono text-red-500" id="final-errors"
                  >0</span
                >
              </div>
            </div>
            <!-- Try Again Button -->
            <button
              id="try-again-btn"
              class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors font-medium"
              aria-label="Start a new typing test"
            >
              Try Again
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer / Toolbar -->
    <footer class="w-full px-8 py-8 flex justify-center items-center z-50">
      <div
        class="flex items-center gap-8 bg-white/5 dark:bg-white/5 backdrop-blur-sm px-6 py-3 rounded-full border border-gray-200/10 dark:border-gray-700/30 shadow-lg"
      >
        <!-- Restart Button -->
        <button
          aria-label="Restart Test"
          id="restart-btn"
          class="group flex items-center justify-center p-2 rounded-lg text-gray-400 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-white/10 transition-all duration-200"
        >
          <span
            class="material-symbols-outlined text-[24px] group-hover:rotate-180 transition-transform duration-500"
            >refresh</span
          >
        </button>
        <!-- Separator -->
        <div class="w-px h-6 bg-gray-300 dark:bg-gray-700"></div>
        <!-- History Button -->
        <button
          aria-label="History"
          id="history-btn"
          class="group flex items-center justify-center p-2 rounded-lg text-gray-400 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-white/10 transition-all duration-200"
        >
          <span class="material-symbols-outlined text-[24px]">history</span>
        </button>
        <!-- Settings Button (Visual only for now) -->
        <button
          aria-label="Settings"
          id="settings-btn"
          class="group flex items-center justify-center p-2 rounded-lg text-gray-400 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-white/10 transition-all duration-200"
        >
          <span
            class="material-symbols-outlined text-[24px] group-hover:rotate-90 transition-transform duration-300"
            >tune</span
          >
        </button>
        <!-- Language/Mode Button (Visual only) -->
        <button
          class="flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
        >
          <span class="material-symbols-outlined text-[18px]">language</span>
          <span>English</span>
        </button>
      </div>
    </footer>

    <!-- Settings Overlay -->
    <div
      id="settings-overlay"
      class="hidden fixed inset-0 z-[90] flex items-center justify-center bg-black/50 backdrop-blur-sm opacity-0 transition-opacity duration-300"
      role="dialog"
      aria-modal="true"
      aria-labelledby="settings-title"
      aria-hidden="true"
    >
      <div
        class="bg-white dark:bg-surface-dark w-full max-w-xl rounded-2xl shadow-2xl p-6 transform scale-95 transition-transform duration-300 border border-gray-200 dark:border-gray-700"
        id="settings-modal-content"
      >
        <div class="flex justify-between items-center mb-4">
          <h2
            id="settings-title"
            class="text-xl font-bold text-gray-800 dark:text-white"
          >
            Session Settings
          </h2>
          <button
            id="close-settings-btn"
            class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white transition-colors"
            aria-label="Close settings"
          >
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <!-- Mode -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-semibold text-gray-700 dark:text-gray-200"
              >Mode</label
            >
            <select
              id="mode-select"
              class="rounded-md border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-surface-dark"
            >
              <option value="time">Time (seconds)</option>
              <option value="words">Word count</option>
            </select>
          </div>

          <!-- Time Presets -->
          <div class="flex flex-col gap-2" id="time-select-group">
            <label
              class="text-sm font-semibold text-gray-700 dark:text-gray-200"
              >Time limit</label
            >
            <select
              id="time-select"
              class="rounded-md border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-surface-dark"
            >
              <option value="15">15s</option>
              <option value="30">30s</option>
              <option value="60" selected>60s</option>
              <option value="120">120s</option>
            </select>
          </div>

          <!-- Word Count Presets -->
          <div class="flex flex-col gap-2 hidden" id="words-select-group">
            <label
              class="text-sm font-semibold text-gray-700 dark:text-gray-200"
              >Word count</label
            >
            <select
              id="words-select"
              class="rounded-md border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-surface-dark"
            >
              <option value="25">25 words</option>
              <option value="50" selected>50 words</option>
              <option value="100">100 words</option>
            </select>
          </div>

          <!-- Text Source -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-semibold text-gray-700 dark:text-gray-200"
              >Text source</label
            >
            <select
              id="text-source-select"
              class="rounded-md border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-surface-dark"
            >
              <option value="random" selected>Random passage</option>
              <option value="custom">Custom text</option>
            </select>
          </div>
        </div>

        <!-- Difficulty Toggles -->
        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <label
            class="inline-flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200"
          >
            <input
              type="checkbox"
              id="toggle-case"
              class="rounded border-gray-300 dark:border-gray-700"
            />
            Case sensitive
          </label>
          <label
            class="inline-flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200"
          >
            <input
              type="checkbox"
              id="toggle-punctuation"
              class="rounded border-gray-300 dark:border-gray-700"
              checked
            />
            Include punctuation
          </label>
          <label
            class="inline-flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200"
          >
            <input
              type="checkbox"
              id="toggle-nobackspace"
              class="rounded border-gray-300 dark:border-gray-700"
            />
            No backspace mode
          </label>
          <label
            class="inline-flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200"
          >
            <input
              type="checkbox"
              id="toggle-strict"
              class="rounded border-gray-300 dark:border-gray-700"
            />
            Strict mode (must type correctly to advance)
          </label>
          <label
            class="inline-flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200"
          >
            <input
              type="checkbox"
              id="toggle-contrast"
              class="rounded border-gray-300 dark:border-gray-700"
            />
            High contrast
          </label>
          <label
            class="inline-flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200"
          >
            <input
              type="checkbox"
              id="toggle-large-text"
              class="rounded border-gray-300 dark:border-gray-700"
            />
            Larger text
          </label>
          <label
            class="inline-flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200"
          >
            <input
              type="checkbox"
              id="toggle-feedback"
              class="rounded border-gray-300 dark:border-gray-700"
            />
            Sound / haptic feedback
          </label>
        </div>

        <!-- Custom text area -->
        <div class="mt-4 flex flex-col gap-2 hidden" id="custom-text-group">
          <label class="text-sm font-semibold text-gray-700 dark:text-gray-200"
            >Custom text</label
          >
          <textarea
            id="custom-textarea"
            rows="3"
            class="w-full rounded-md border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-surface-dark text-sm p-3"
            placeholder="Paste or type your own passage"
          ></textarea>
        </div>

        <!-- Actions -->
        <div class="mt-6 flex flex-wrap gap-3 justify-end">
          <button
            id="randomize-text-btn"
            class="px-4 py-2 rounded-md border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
            type="button"
          >
            New random passage
          </button>
          <button
            id="apply-settings-btn"
            class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors"
            type="button"
          >
            Apply & restart
          </button>
        </div>
      </div>
    </div>

    <!-- History Overlay -->
    <div
      id="history-overlay"
      class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm opacity-0 transition-opacity duration-300"
      role="dialog"
      aria-modal="true"
      aria-labelledby="history-title"
      aria-hidden="true"
    >
      <div
        class="bg-white dark:bg-surface-dark w-full max-w-lg rounded-2xl shadow-2xl p-6 transform scale-95 transition-transform duration-300 border border-gray-200 dark:border-gray-700"
        id="history-modal-content"
      >
        <div class="flex justify-between items-center mb-6">
          <h2
            id="history-title"
            class="text-xl font-bold text-gray-800 dark:text-white"
          >
            Recent Attempts
          </h2>
          <button
            id="close-history-btn"
            class="text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white transition-colors"
          >
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <div class="flex flex-wrap gap-3 items-center mb-4">
          <label
            class="text-sm text-gray-500 dark:text-gray-300 flex items-center gap-2"
          >
            Filter:
            <select
              id="history-filter"
              class="rounded-md border-gray-300 dark:border-gray-700 bg-white/70 dark:bg-surface-dark text-sm"
            >
              <option value="all">All</option>
              <option value="day">Last 24h</option>
              <option value="week">Last 7d</option>
              <option value="month">Last 30d</option>
            </select>
          </label>
          <div class="flex gap-2 ml-auto">
            <button
              id="export-json-btn"
              class="px-3 py-1.5 rounded-md border border-gray-300 dark:border-gray-700 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-white/10"
            >
              Export JSON
            </button>
            <button
              id="export-csv-btn"
              class="px-3 py-1.5 rounded-md border border-gray-300 dark:border-gray-700 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-white/10"
            >
              Export CSV
            </button>
            <button
              id="clear-history-btn"
              class="px-3 py-1.5 rounded-md border border-red-300 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20"
            >
              Clear
            </button>
          </div>
        </div>
        <div
          class="overflow-y-auto max-h-[60vh] space-y-3 pr-2"
          id="history-list"
        >
          <!-- History Items injected here -->
          <div class="text-center text-gray-500 py-8">No attempts yet</div>
        </div>
      </div>
    </div>

    <script src="script.js" defer></script>
    <div id="sr-live" class="sr-only" aria-live="polite"></div>
  </body>
</html>
